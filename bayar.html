
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌳 Pesan Hutan Keajaiban untuk Rizal 🌳</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Fauna+One&family=Lora:ital,wght@0,400;0,600;1,400&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Caveat:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lora', serif;
            overflow-x: hidden;
            background: linear-gradient(170deg, #061006 0%, #0a1c0a 25%, #102810 50%, #183818 75%, #0d1a0d 100%);
            background-attachment: fixed;
            animation: ultraDeepForestAmbience 40s ease-in-out infinite alternate;
            color: #e8f5e9;
            position: relative;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        @keyframes ultraDeepForestAmbience {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        #storytelling-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(3, 10, 3, 0.99);
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1.0s ease-in-out, visibility 0s linear 1.0s;
        }

        #storytelling-overlay.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 1.0s ease-in-out, visibility 0s linear 0s;
        }

        #story-text {
            font-family: 'Merriweather', serif;
            font-size: clamp(1.1rem, 3.5vw, 1.7rem);
            color: rgba(224, 240, 224, 0.95);
            line-height: 1.9;
            max-width: 700px;
            opacity: 0; 
            transition: opacity 0.4s ease-in-out; 
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        #story-text.dramatic-reveal-story {
            font-family: 'Cinzel Decorative', cursive;
            font-size: clamp(1.4rem, 4.2vw, 2rem);
            color: #f8f8a0 !important;
            text-shadow: 0 0 12px #f8f8a0, 0 0 18px #f8f8a0, 0 0 25px #f8f8a0;
        }
        #story-text.visible-text {
            opacity: 1;
        }

        #start-adventure-btn {
            background: linear-gradient(135deg, #1a511a, #0b3d0b 50%, #287d28);
            background-size: 300% 300%;
            color: #e0f0e0;
            border: 2px solid rgba(100, 180, 110, 0.6);
            padding: 1rem 2.2rem;
            border-radius: 50px;
            font-family: 'Cinzel Decorative', cursive;
            font-size: clamp(1.1rem, 4.5vw, 1.5rem);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 35px rgba(5, 25, 10, 0.8), 
                        inset 0 -4px 10px rgba(0,0,0,0.5),
                        0 0 15px rgba(144, 238, 144, 0.3); 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            animation: btnPulseMagical 3s infinite, btnGradientShiftMystic 6s ease infinite;
            margin-top: 1.5rem;
            display: none; 
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }
      
        @keyframes btnPulseMagical { 
            0% { transform: scale(1); box-shadow: 0 10px 35px rgba(5, 25, 10, 0.8), inset 0 -4px 10px rgba(0,0,0,0.5), 0 0 15px rgba(144, 238, 144, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 14px 45px rgba(10, 35, 15, 0.9), inset 0 -4px 10px rgba(0,0,0,0.5), 0 0 25px rgba(144, 238, 144, 0.5), 0 0 35px #90ee90; }
            100% { transform: scale(1); box-shadow: 0 10px 35px rgba(5, 25, 10, 0.8), inset 0 -4px 10px rgba(0,0,0,0.5), 0 0 15px rgba(144, 238, 144, 0.3); }
        }

        #start-adventure-btn:hover {
            background-position: 100% 50%; 
            transform: translateY(-5px) scale(1.07);
            box-shadow: 0 18px 50px rgba(15, 45, 20, 1), 
                        inset 0 -4px 10px rgba(0,0,0,0.55),
                        0 0 30px #a0ffa0,
                        0 0 40px #b8ffb8;
            border-color: rgba(140, 220, 150, 0.8);
        }
       
        #start-adventure-btn:active {
            transform: translateY(-2px) scale(1.02);
             box-shadow: 0 8px 30px rgba(5, 25, 10, 0.7), 
                        inset 0 -2px 8px rgba(0,0,0,0.6),
                        0 0 20px rgba(144, 238, 144, 0.4);
        }

        /* ... (CSS Lainnya SAMA seperti sebelumnya) ... */
        .hills-container { position: fixed; bottom: 0; left: 0; width: 100%; height: auto; max-height: 45vh; z-index: 1; pointer-events: none; overflow: hidden; }
        .hills-container svg { width: 100%; height: 100%; display: block; position: absolute; bottom: 0; }
        .mist-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 30vh; overflow: hidden; z-index: 2; pointer-events: none; opacity: 0.45; }
        .mist-layer { position: absolute; bottom: -5vh; left: 0; width: 250%; height: 120%; background: linear-gradient(to top, rgba(8, 18, 8, 0.65) 0%, rgba(8, 18, 8, 0.4) 40%, rgba(8, 18, 8, 0) 100%); animation: driftMistEnhanced 100s linear infinite; }
        .mist-layer.mist-layer-2 { width: 280%; animation-duration: 130s; animation-delay: -35s; opacity: 0.6; bottom: -8vh; }
        @keyframes driftMistEnhanced { 0% { transform: translateX(0%); } 50% { transform: translateX(-30%); } 100% { transform: translateX(0%); } }
        .fireflies { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 3; pointer-events: none; }
        .firefly { position: absolute; width: var(--firefly-size, 2.5px); height: var(--firefly-size, 2.5px); background: #f8f8a0; border-radius: 50%; box-shadow: 0 0 calc(var(--firefly-size, 2.5px) * 2) #f8f8a0, 0 0 calc(var(--firefly-size, 2.5px) * 3.5) #f8f8a0, 0 0 calc(var(--firefly-size, 2.5px) * 5) #fffacd; animation: driftEnhanced 11s infinite linear; opacity: 0; }
        @keyframes driftEnhanced { 0% { transform: translate(0, 0) scale(var(--firefly-scale-start, 0.4)); opacity: 0; } 10% { opacity: var(--firefly-opacity, 0.8); } 50% { transform: translate(var(--firefly-drift-x, 28px), var(--firefly-drift-y, -38px)) scale(var(--firefly-scale-mid, 1.1)); } 70% { opacity: calc(var(--firefly-opacity, 0.8) * 0.7); } 90% { opacity: var(--firefly-opacity, 0.8); } 100% { transform: translate(calc(var(--firefly-drift-x, 28px)*0.6), calc(var(--firefly-drift-y, -38px)*0.6)) scale(var(--firefly-scale-end, 0.4)); opacity: 0; } }
        .forest-sparkles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 4; pointer-events: none; }
        .forest-sparkle { position: absolute; width: 2px; height: 2px; background: #a0d0a0; border-radius: 50%; box-shadow: 0 0 6px #a0d0a0, 0 0 10px #b8e0b8, 0 0 3px #d0f0d0; animation: forestSparkleFloatEnhanced 8.5s infinite linear; opacity: 0; }
        @keyframes forestSparkleFloatEnhanced { 0% { transform: translateY(100vh) translateX(0) rotate(0deg) scale(0.3); opacity: 0; } 10% { opacity: 0.85; } 50% { transform: scale(1.2); } 90% { opacity: 0.85; } 100% { transform: translateY(-10vh) translateX(var(--sparkle-drift-x, 48px)) rotate(380deg) scale(0.5); opacity: 0; } }

        .container {
            position: relative; z-index: 10; max-width: 580px; width: calc(100% - 2rem); margin-left: auto; margin-right: auto;
            opacity: 0; visibility: hidden; transition: opacity 1.2s ease-in-out, visibility 0s linear 1.2s;
        }
        .container.visible { opacity: 1; visibility: visible; transition: opacity 1.2s ease-in-out, visibility 0s linear 0s; }

        .card { background: rgba(4, 12, 6, 0.92); backdrop-filter: blur(16px); border: 2px solid rgba(60, 110, 70, 0.7); border-radius: 20px; padding: clamp(2rem, 5.5vw, 2.6rem); box-shadow: 0 25px 65px rgba(0, 0, 0, 0.8); text-align: center; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(80, 140, 90, 0.09) 0%, transparent 70%); animation: magicalShineDeeper 11s infinite linear; opacity: 0.5; }
        @keyframes magicalShineDeeper { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .header-title { font-family: 'Cinzel Decorative', cursive; font-size: clamp(2.1rem, 7.2vw, 3.9rem); font-weight: 700; color: #b8e0b8; margin-bottom: 1.1rem; text-shadow: 0 0 15px rgba(140, 200, 140, 0.65), 0 0 25px rgba(160, 220, 160, 0.45); animation: titleGlowMysticEnhanced 3.2s ease-in-out infinite alternate; position: relative; z-index: 2; }
        .card.content-revealed .header-title { font-family: 'Cinzel', serif; font-size: clamp(1.75rem, 5.6vw, 2.75rem); font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: #cfe8cf; }
        @keyframes titleGlowMysticEnhanced { from { text-shadow: 0 0 13px rgba(140, 200, 140, 0.6), 0 0 22px rgba(160, 220, 160, 0.4); opacity: 0.92; } to { text-shadow: 0 0 24px rgba(140, 200, 140, 0.75), 0 0 40px rgba(160, 220, 160, 0.6), 0 0 9px #f8fff8; opacity: 1; } }
        .subtitle { font-family: 'Fauna One', serif; font-size: clamp(0.98rem, 3.9vw, 1.32rem); margin-bottom: 2.2rem; color: rgba(195, 225, 195, 0.93); font-weight: 400; animation: subtitleFadeMystic 2s ease-out 1s forwards; opacity: 0; }
        @keyframes subtitleFadeMystic { to { opacity: 0.93; } }
        #countdown { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 2.2rem 0; animation: countdownAppear 2s ease-out 1.2s forwards; opacity: 0; }
        @media (min-width: 500px) { #countdown { grid-template-columns: repeat(4, 1fr); } } @keyframes countdownAppear { to { opacity: 1; } }
        .countdown-item { background: rgba(50, 100, 60, 0.28); border: 1px solid rgba(70, 120, 80, 0.7); border-radius: 16px; padding: 1rem; backdrop-filter: blur(9px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; box-shadow: 0 0 16px rgba(70, 120, 80, 0.45); }
        .countdown-item:hover { transform: translateY(-8px) scale(1.08); box-shadow: 0 10px 33px rgba(15, 50, 25, 0.65), 0 0 24px rgba(70, 120, 80, 0.75); }
        .countdown-number { font-family: 'Cinzel Decorative', cursive; font-size: clamp(1.55rem, 5.6vw, 2.35rem); font-weight: 700; color: #cfe8cf; display: block; text-shadow: 0 1px 9px rgba(0,0,0, 0.6); }
        .countdown-label { font-family: 'Fauna One', serif; font-size: clamp(0.62rem, 2.75vw, 0.82rem); color: rgba(185, 215, 185, 0.9); text-transform: uppercase; letter-spacing: 1.2px; margin-top: 0.5rem; font-weight: 400; }
        .reveal-btn { background: linear-gradient(45deg, #134e13, #082808, #1e681e); background-size: 250% 250%; color: #d8f8d8; border: 1px solid rgba(90,160,100,0.55); padding: 0.9rem 1.8rem; border-radius: 30px; font-family: 'Cinzel Decorative', cursive; font-size: clamp(0.9rem, 3.8vw, 1.1rem); font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 7px 28px rgba(3, 20, 8, 0.7), inset 0 -3px 8px rgba(0,0,0,0.4); animation: btnPulseMysticEnhanced 2.6s infinite, btnGradientShiftMystic 5s ease infinite; margin: 2.2rem 0; display: none; text-transform: uppercase; letter-spacing: 1px; }
        @keyframes btnGradientShiftMystic { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        @keyframes btnPulseMysticEnhanced { 0% { transform: scale(1); box-shadow: 0 7px 28px rgba(3, 20, 8, 0.7), inset 0 -3px 8px rgba(0,0,0,0.4); } 50% { transform: scale(1.04); box-shadow: 0 9px 36px rgba(3, 20, 8, 0.9), 0 0 24px #90d090, inset 0 -3px 8px rgba(0,0,0,0.4); } 100% { transform: scale(1); box-shadow: 0 7px 28px rgba(3, 20, 8, 0.7), inset 0 -3px 8px rgba(0,0,0,0.4); } }
        .reveal-btn:hover { transform: translateY(-4px) scale(1.04); box-shadow: 0 11px 36px rgba(3, 20, 8, 0.8), 0 0 30px #b8e0b8, inset 0 -3px 8px rgba(0,0,0,0.45); }
        .birthday-content { display: none; animation: contentAppearMystic 2s ease-out forwards; margin-top: 2.2rem; }
        @keyframes contentAppearMystic { 0% { opacity: 0; transform: translateY(20px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
        .birthday-message { background: rgba(70, 120, 80, 0.15); border-radius: 16px; padding: 1.6rem; margin: 1.1rem 0; border: 1px solid rgba(90, 150, 100, 0.55); backdrop-filter: blur(9px); font-size: clamp(0.9rem, 3.5vw, 1.05rem); line-height: 1.75; color: #e8f5e9; }
        .birthday-message h2 { font-family: 'Cinzel Decorative', cursive; color: #b8e0b8; margin-bottom: 0.8rem; font-size: clamp(1.5rem, 4.5vw, 2.2rem); font-weight: 700; }
        .special-wish-btn { background: linear-gradient(45deg, #388e3c, #2e7d32); color: #061006; border: 1px solid rgba(110,190,120,0.45); padding: 0.8rem 1.6rem; border-radius: 25px; font-family: 'Fauna One', serif; font-size: clamp(0.8rem, 3.2vw, 1rem); font-weight: 600; cursor: pointer; margin: 1.6rem 0; transition: all 0.3s ease; display: none; box-shadow: 0 5px 22px rgba(15, 50, 25,0.5); }
        .special-wish-btn:hover { transform: translateY(-3px); box-shadow: 0 9px 30px rgba(15, 50, 25,0.6), 0 0 18px #cfe8cf; }
        .special-wish-container { display: none; background: rgba(5, 14, 7, 0.94); color: #e8f5e9; border-radius: 16px; padding: 1.8rem; margin: 1.6rem 0; box-shadow: 0 12px 42px rgba(0, 0, 0, 0.65); text-align: left; line-height: 1.8; font-size: clamp(0.88rem, 3.1vw, 0.98rem); border: 1px solid #284828; animation: fadeInSpecialWish 1s ease-out; }
        @keyframes fadeInSpecialWish { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .special-wish-container strong { color: #b8e0b8; font-weight: 600; } .special-wish-container em { color: #cfe8cf; font-style: italic; font-weight: 400; }
        .from-siblings { text-align: right; margin-top: 1.5rem; font-style: italic; color: #cad8ca; font-size: 0.9em; }
        .footer { margin-top: 2.2rem; font-size: clamp(0.8rem, 2.8vw, 0.9rem); color: rgba(195, 225, 195, 0.88); font-weight: 400; font-family: 'Fauna One', serif; }
        .leaf-fall-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 15; pointer-events: none; display: none; }
        .leaf { position: absolute; width: clamp(13px, 2.7vw, 22px); height: clamp(13px, 2.7vw, 22px); background-size: contain; background-repeat: no-repeat; animation: fallDeeperForest 9s linear infinite; opacity: 0; }
        @keyframes fallDeeperForest { 0% { transform: translateY(-10vh) translateX(0px) rotate(0deg) scale(0.7); opacity: 1; } 25% { transform: translateX(var(--leaf-drift-x-mid, 40px)) rotate(150deg); } 100% { transform: translateY(110vh) translateX(var(--leaf-drift-x-end, 90px)) rotate(680deg) scale(1); opacity: 0; } }
        .badge { position: absolute; top: -11px; right: -11px; background: linear-gradient(135deg, #1e681e, #0a3d0a); color: #d8f8d8; border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; font-size: 23px; animation: badgeSway 3s ease-in-out infinite; box-shadow: 0 5px 18px rgba(3, 20, 8, 0.6); z-index: 100; }
        @keyframes badgeSway { 0%, 100% { transform: rotate(-5deg) scale(1); } 50% { transform: rotate(5deg) scale(1.1); } }
        @media (max-width: 768px) { body { padding: 1rem 0.5rem; } .container { width: calc(100% - 1rem); margin-top: 1rem; margin-bottom: 1rem; } .card { padding: 2rem; } .hills-container { max-height: 40vh; } #countdown { gap: 0.8rem; } .countdown-item { padding: 0.9rem; } .header-title { font-size: clamp(2.0rem, 7vw, 3.5rem); } .card.content-revealed .header-title { font-size: clamp(1.7rem, 5.2vw, 2.6rem); } .subtitle { font-size: clamp(0.9rem, 3.5vw, 1.25rem); } .birthday-message h2 { font-size: clamp(1.4rem, 4vw, 2.0rem); } #story-text { font-size: clamp(1rem, 3.2vw, 1.5rem); } #start-adventure-btn { padding: 0.8rem 1.8rem; font-size: clamp(1rem, 4vw, 1.3rem);}}
        @media (max-width: 480px) { .hills-container { max-height: 35vh; } .card { padding: 1.3rem; border-radius: 15px; } #countdown { gap: 0.5rem; } .countdown-item { padding: 0.7rem; border-radius: 10px; } .reveal-btn { padding: 0.8rem 1.5rem; font-size: 0.85rem; } .header-title { font-size: clamp(1.8rem, 7.2vw, 3.2rem); } .card.content-revealed .header-title { font-size: clamp(1.5rem, 4.8vw, 2.3rem); } .subtitle { font-size: clamp(0.85rem, 3.8vw, 1.15rem); margin-bottom: 1.8rem; } .birthday-message h2 { font-size: clamp(1.3rem, 3.8vw, 1.8rem); } #story-text { font-size: clamp(0.95rem, 3.5vw, 1.3rem); line-height: 1.8; } #start-adventure-btn { padding: 0.7rem 1.5rem; font-size: clamp(0.9rem, 3.8vw, 1.1rem);} }
    </style>
</head>
<body>
    <div id="storytelling-overlay">
        <p id="story-text"></p>
        <button id="start-adventure-btn">Masuki Hutan Keajaiban</button>
    </div>

    <audio id="narrationAudio" preload="auto"></audio>

    <div class="hills-container">
        <svg viewBox="0 0 1200 350" preserveAspectRatio="xMidYMax slice" style="z-index: 1; opacity: 0.65;">
            <defs><filter id="faintBlur" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur in="SourceGraphic" stdDeviation="0.5"/></filter></defs>
            <path d="M0,350 L0,240 Q130,200 290,240 T580,210 T850,250 T1100,200 T1200,230 L1200,350 Z" fill="#040c04" filter="url(#faintBlur)"/>
            <path d="M0,350 L0,250 Q100,220 250,250 T520,230 T780,260 T1020,220 T1200,240 L1200,350 Z" fill="#050f05" transform="translate(30, 5) scale(1.02)" filter="url(#faintBlur)"/>
        </svg>
        <svg viewBox="0 0 1200 320" preserveAspectRatio="xMidYMax slice" style="z-index: 2; opacity: 0.8; bottom: -3vh;">
            <path d="M0,320 L0,210 Q160,170 340,210 T630,180 T900,220 T1150,170 T1200,200 L1200,320 Z" fill="#081808"/>
            <path d="M0,320 L0,220 Q140,190 300,220 T590,200 T860,230 T1120,190 T1200,210 L1200,320 Z" fill="#0a1c0a" transform="translate(-25, 6) scale(1.03)"/>
            <circle cx="150" cy="195" r="12" fill="#061206" opacity="0.5"/> <circle cx="170" cy="185" r="10" fill="#061206" opacity="0.5"/>
            <circle cx="450" cy="190" r="15" fill="#061206" opacity="0.5"/> <circle cx="480" cy="180" r="13" fill="#061206" opacity="0.5"/>
            <circle cx="750" cy="200" r="14" fill="#061206" opacity="0.5"/> <circle cx="785" cy="190" r="11" fill="#061206" opacity="0.5"/>
            <circle cx="1050" cy="185" r="16" fill="#061206" opacity="0.5"/> <circle cx="1020" cy="195" r="12" fill="#061206" opacity="0.5"/>
        </svg>
        <svg viewBox="0 0 1200 280" preserveAspectRatio="xMidYMax slice" style="z-index: 3; opacity: 0.95; bottom: -6vh;">
            <path d="M0,280 L0,190 Q190,150 380,190 T680,160 T980,200 T1200,170 L1200,280 Z" fill="#102810"/>
            <path d="M0,280 L0,200 Q170,170 360,200 T660,180 T960,210 T1200,190 L1200,280 Z" fill="#0e220e" transform="translate(20, 7) scale(1.02)"/>
            <ellipse cx="250" cy="175" rx="25" ry="18" fill="#0a1c0a" opacity="0.6"/> <ellipse cx="280" cy="165" rx="22" ry="16" fill="#0a1c0a" opacity="0.6"/>
            <ellipse cx="550" cy="170" rx="30" ry="20" fill="#0a1c0a" opacity="0.6"/> <ellipse cx="590" cy="160" rx="28" ry="18" fill="#0a1c0a" opacity="0.6"/>
            <ellipse cx="850" cy="180" rx="28" ry="19" fill="#0a1c0a" opacity="0.6"/> <ellipse cx="820" cy="190" rx="25" ry="17" fill="#0a1c0a" opacity="0.6"/>
        </svg>
    </div>

    <div class="mist-container">
        <div class="mist-layer"></div>
        <div class="mist-layer mist-layer-2"></div>
    </div>

    <div class="fireflies" id="fireflies-container"></div>
    <div class="forest-sparkles" id="forest-sparkles-container"></div>

    <div class="container" id="main-container">
        <div class="card" id="mainCard">
            <div class="badge">🌿</div>
            <h1 id="main-title" class="header-title">Hutan Menanti Saatnya</h1>
            <p id="subtitle" class="subtitle">Untuk Muhammad Rizal Setiawan, Penjaga Jiwa yang Bijaksana ✨</p>
            <div id="countdown">
                <div class="countdown-item"> <span id="days" class="countdown-number">00</span> <div class="countdown-label">Hari</div> </div>
                <div class="countdown-item"> <span id="hours" class="countdown-number">00</span> <div class="countdown-label">Jam</div> </div>
                <div class="countdown-item"> <span id="minutes" class="countdown-number">00</span> <div class="countdown-label">Menit</div> </div>
                <div class="countdown-item"> <span id="seconds" class="countdown-number">00</span> <div class="countdown-label">Detik</div> </div>
            </div>
            <button id="reveal-btn" class="reveal-btn"> 🍃 Sentuh Keajaiban Alam 🍃 </button>
            <div id="birthday-content" class="birthday-content">
                <div class="birthday-message"> <h2>🌳 Selamat Ulang Tahun, Rizal! 🌳</h2> <p>Saudaraku, Muhammad Rizal Setiawan, semoga di usiamu yang baru ini, jalan hidupmu diberkahi keteduhan dan kekuatan laksana hutan yang senantiasa tumbuh dan memberi kehidupan.</p> </div>
                <div class="birthday-message"> <p>🌟 Semoga setiap langkahmu diterangi cahaya kearifan, hatimu sekuat akar pohon yang mencengkeram bumi, dan jiwamu setenang embun pagi di dedaunan. Teruslah bertumbuh menjadi pribadi yang menginspirasi! 🌟</p> </div>
                <div class="birthday-message"> <p>💖 Kami semua, keluargamu, mendoakan yang terbaik untukmu. Nikmati hari istimewamu ini dengan sukacita, kedamaian, dan rasa syukur yang mendalam. 💖</p> </div>
                <button id="special-wish-btn" class="special-wish-btn"> 📜 Buka Gulungan Doa dari Hati Hutan 📜 </button>
                <div id="special-wish-container" class="special-wish-container"></div>
            </div>
            <div class="footer"> 🍂 Dari Hati yang Tulus, Semua Saudaramu 🍂 </div>
        </div>
    </div>

    <div class="leaf-fall-container" id="leaf-fall-container"></div>

    <script>
        // DOM Elements
        const firefliesContainer = document.getElementById('fireflies-container');
        const forestSparklesContainer = document.getElementById('forest-sparkles-container');
        const leafFallContainer = document.getElementById('leaf-fall-container');
        const mainContainerEl = document.getElementById('main-container');
        const cardEl = document.getElementById('mainCard');
        const countdownEl = document.getElementById('countdown');
        const birthdayContentEl = document.getElementById('birthday-content');
        const mainTitleEl = document.getElementById('main-title');
        const subtitleEl = document.getElementById('subtitle');
        const specialWishBtn = document.getElementById('special-wish-btn');
        const specialWishContainer = document.getElementById('special-wish-container');
        const revealBtn = document.getElementById('reveal-btn');
        const storytellingOverlayEl = document.getElementById('storytelling-overlay');
        const storyTextEl = document.getElementById('story-text');
        const narrationAudioEl = document.getElementById('narrationAudio');
        const startAdventureBtn = document.getElementById('start-adventure-btn');

        // Config
        const numFireflies = window.innerWidth < 768 ? 150 : 300;
        const numForestSparkles = window.innerWidth < 768 ? 35 : 70;
        
        const narrationAudioSrc_beforeBirthday = 'https://raw.githubusercontent.com/mrsetiawans/audios/refs/heads/main/download%20(6).wav';
        const narrationAudioSrc_onBirthdayProlog = 'https://raw.githubusercontent.com/mrsetiawans/audios/refs/heads/main/download%20(7).wav';
        const narrationAudioSrc_revealClicked = 'https://raw.githubusercontent.com/mrsetiawans/audios/refs/heads/main/download%20(9).wav'; 
        const narrationAudioSrc_afterThirtyDays = 'https://raw.githubusercontent.com/mrsetiawans/audios/refs/heads/main/download%20(10).wav'; 
        const narrationAudioSrc_cardCommand = 'https://raw.githubusercontent.com/mrsetiawans/audios/refs/heads/main/download%20(11).wav';

        const birthdayDate = new Date(2025, 4, 23, 0, 0, 0).getTime(); 
        const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;
        const dramaticRevealClassName = 'dramatic-reveal-story';
        
        // State
        let narrationAudioReady = false;
        let currentNarrationSegmentIndex = -1;
        let initialLoad = true;
        let musicStarted = false;
        let userInteractedForAudio = false;
        let activeSequenceName = null; 
        let currentNarrationAudioSrc = null; 
        let playCommandAudioOnInteraction = false;
        let currentCommandAudioPlayer = null; 

        const audio = new Audio('https://cdn.sanity.io/files/zhgxj6ko/production/20096b856584fe42be47145334272a834c663ffe.mp3');
        audio.loop = true;

        const storySequences = {
            beforeBirthday: [
                { text: "Dalam keheningan hutan zamrud, di mana cahaya mentari menari di antara dedaunan purba...", audioStart: 0.5, audioEnd: 10.0, isNarration: true },
                { text: "Legenda berbisik tentang sebuah energi murni, sebuah hadiah jiwa yang tersimpan, menunggu saat yang tepat untuk bersemi...", audioStart: 10.1, audioEnd: 26.5, isNarration: true },
                { text: "Energi ini terjalin dengan takdir seorang penjaga jiwa: Muhammad Rizal Setiawan.", audioStart: 26.6, audioEnd: 37.5, isNarration: true },
                { text: "Namun, segel waktu masih menguncinya. Hutan ini sabar menanti... hitungan mundur menuju keajaiban telah dimulai.", audioStart: 37.6, audioEnd: 53.8, isNarration: true, action: 'showCountdownCard' }
            ],
            onBirthdayProlog: [ 
                { text: "Hari ini, udara Hutan Keajaiban bergetar berbeda... Ada desiran energi yang tak biasa, seolah alam semesta merayakan.", audioStart: 0.0, audioEnd: 13.5, isNarration: true },
                { text: "Segel waktu telah memudar, namun sebuah tabir tipis masih menyelimuti inti hadiah untuk Muhammad Rizal Setiawan.", audioStart: 14.5, audioEnd: 26.5, isNarration: true },
                { text: "Sebuah sentuhan, sebuah niat tulus, diperlukan untuk menyingkap keajaiban terakhir...", audioStart: 27.5, audioEnd: 35.8, isNarration: true, action: 'showRevealButtonCard' }
            ],
            revealClickedStory: [ 
                 { text: "Dengan sentuhanmu yang penuh harapan, tabir terakhir tersibak perlahan...", audioStart: 0.5, audioEnd: 7.0, isNarration: true },
                 { text: "Dari jantung hutan yang paling dalam, terdengar simfoni alam yang agung...<br>dan di tengah cahaya lembut, sebuah pesan mulai terbentuk...", audioStart: 8.0, audioEnd: 21.8, isNarration: true },
                 { text: "Dan akhirnya, inilah dia...<br>bisikan hati hutan, sebuah gulungan doa yang terjalin dari akar kebijaksanaan dan kasih sayang abadi...", audioStart: 22.5, audioEnd: 37.5, isNarration: true, action: 'finalizeBirthdayMessages' }
            ],
            afterThirtyDays: [ 
                { text: "Selamat datang kembali, Penjelajah Jiwa...<br>Jejak perayaan masih menghangatkan udara Hutan Keajaiban ini, Rizal.<br><br>Gema sukacita dan doa-doa yang terucap untukmu masih bersemayam di antara pepohonan rindang.", audioStart: 0.4, audioEnd: 22.7, isNarration: true },
                { text: "Meskipun puncak perayaan telah berlalu, esensi keajaiban hutan tak pernah sirna.<br>Ia kini beristirahat dengan tenang, mengumpulkan energi baru, dan menyimpan kenangan indah ini dalam serat kayunya yang abadi, menantikan musim kebijaksanaanmu berikutnya...", audioStart: 23.0, audioEnd: 51.5, isNarration: true, action: 'showPostBirthdayCard' }
            ]
        };

        function stopNarrationAndCleanup(preserveActiveSequence = false) { // Added parameter
            if (narrationAudioEl) {
                if (!narrationAudioEl.paused) narrationAudioEl.pause();
                narrationAudioEl.removeEventListener('timeupdate', handleNarrationTimeUpdate);
                narrationAudioEl.removeEventListener('ended', handleNarrationEnded);
                narrationAudioEl.removeEventListener('canplaythrough', startNarrationForActiveSequence);
                narrationAudioEl.removeEventListener('error', handleNarrationLoadError);
            }
            currentNarrationSegmentIndex = -1;
            if (storyTextEl) {
                storyTextEl.innerHTML = ""; 
                storyTextEl.classList.remove('visible-text', dramaticRevealClassName);
            }
            if (startAdventureBtn) startAdventureBtn.style.display = 'none'; 
            if(!preserveActiveSequence) activeSequenceName = null; // Conditionally reset activeSequenceName
        }
        
        function handleNarrationLoadError() {
            console.error(`Error loading narration audio file: ${narrationAudioEl.src}`);
            if (activeSequenceName && storySequences[activeSequenceName]?.[0]?.isNarration) {
                let errorMessage = "Gagal memuat file audio narasi.";
                if (activeSequenceName === 'revealClickedStory') {
                    errorMessage = "Gagal memuat audio keajaiban. Mohon segarkan halaman atau coba lagi nanti.";
                } else if (activeSequenceName === 'afterThirtyDays') {
                    errorMessage = "Gagal memuat audio kenangan. Mohon segarkan halaman atau coba lagi nanti.";
                }
                storyTextEl.innerHTML = errorMessage;
                storyTextEl.classList.add('visible-text');
            }
             if (startAdventureBtn) startAdventureBtn.style.display = 'none'; 
            narrationAudioReady = true; 
        }

        function startNarrationForActiveSequence() {
            if (!activeSequenceName || !storySequences[activeSequenceName]?.[0]?.isNarration || !narrationAudioEl) {
                console.log("startNarrationForActiveSequence: Conditions not met or not a narration sequence.");
                return;
            }
            
            console.log(`Attempting to play narration for: ${activeSequenceName}`);
            if (startAdventureBtn) startAdventureBtn.style.display = 'none'; 
            narrationAudioReady = true; 
            narrationAudioEl.removeEventListener('canplaythrough', startNarrationForActiveSequence);
            narrationAudioEl.removeEventListener('error', handleNarrationLoadError);

            narrationAudioEl.currentTime = 0;
            narrationAudioEl.play()
                .then(() => {
                    console.log(`Narration for '${activeSequenceName}' started playing.`);
                    narrationAudioEl.addEventListener('timeupdate', handleNarrationTimeUpdate);
                    narrationAudioEl.addEventListener('ended', handleNarrationEnded);
                    handleNarrationTimeUpdate(); 
                })
                .catch(e => {
                    console.error(`Error playing narration for '${activeSequenceName}':`, e);
                    let errorMessage = "Gagal memulai audio narasi.";
                     if (activeSequenceName === 'revealClickedStory') {
                       errorMessage = "Gagal memulai audio keajaiban. Mohon periksa koneksi atau coba lagi.";
                    } else if (activeSequenceName === 'afterThirtyDays') {
                        errorMessage = "Gagal memulai audio kenangan. Mohon periksa koneksi atau coba lagi.";
                    }
                    storyTextEl.innerHTML = errorMessage;
                    storyTextEl.classList.add('visible-text');
                    if (startAdventureBtn) startAdventureBtn.style.display = 'none'; 
                });
        }


        function playStorySequence(sequenceName, isContinuation = false) { // Added isContinuation
            console.log(`playStorySequence called for: ${sequenceName}, isContinuation: ${isContinuation}`);
            
            if (!isContinuation) { // Only fully reset if not a continuation after interaction
                if (activeSequenceName && storySequences[activeSequenceName]?.[0]?.isNarration) {
                    stopNarrationAndCleanup();
                }
                activeSequenceName = sequenceName;
            }
            // If isContinuation, activeSequenceName is already set and we don't want to clear it before starting.
            // stopNarrationAndCleanup() might have been called by the button click itself already.

            const currentSequenceIsNarration = storySequences[activeSequenceName]?.[0]?.isNarration;

            storyTextEl.innerHTML = ''; 
            storyTextEl.classList.remove('visible-text', dramaticRevealClassName);
            storytellingOverlayEl.classList.add('visible');

            if (mainContainerEl) mainContainerEl.classList.remove('visible');
            if (revealBtn) revealBtn.style.display = 'none';

            if (!currentSequenceIsNarration) { 
                console.error(`Sequence '${activeSequenceName}' is not defined as a narration sequence or is missing.`);
                storytellingOverlayEl.classList.remove('visible'); 
                if (mainContainerEl) mainContainerEl.classList.add('visible');
                return;
            }

            if (!userInteractedForAudio) {
                console.warn(`Narration for '${activeSequenceName}' deferred: User interaction required. Showing start button.`);
                if (startAdventureBtn) startAdventureBtn.style.display = 'inline-block'; 
                storyTextEl.innerHTML = ''; 
                storyTextEl.classList.remove('visible-text');
                return; 
            }
            if (startAdventureBtn) startAdventureBtn.style.display = 'none';

            if (!narrationAudioEl) {
                console.error(`Narration audio element not found. Cannot play '${activeSequenceName}'.`);
                storyTextEl.innerHTML = storySequences[activeSequenceName][0].text;
                storyTextEl.classList.add('visible-text');
                return;
            }

            let newAudioSrc = null;
            if (activeSequenceName === 'beforeBirthday') newAudioSrc = narrationAudioSrc_beforeBirthday;
            else if (activeSequenceName === 'onBirthdayProlog') newAudioSrc = narrationAudioSrc_onBirthdayProlog;
            else if (activeSequenceName === 'revealClickedStory') newAudioSrc = narrationAudioSrc_revealClicked; 
            else if (activeSequenceName === 'afterThirtyDays') newAudioSrc = narrationAudioSrc_afterThirtyDays;

            if (newAudioSrc && narrationAudioEl.src !== newAudioSrc) {
                console.log(`Setting new narration audio source for '${activeSequenceName}': ${newAudioSrc}`);
                narrationAudioEl.src = newAudioSrc;
                currentNarrationAudioSrc = newAudioSrc; 
                narrationAudioReady = false; 
            } else if (newAudioSrc && narrationAudioEl.src === newAudioSrc) {
                 narrationAudioReady = (currentNarrationAudioSrc === newAudioSrc && narrationAudioReady);
            } else if (!newAudioSrc) { 
                console.error(`No audio source defined for narrated sequence: ${activeSequenceName}. Cannot play audio.`);
                storyTextEl.innerHTML = "Audio untuk cerita ini tidak ditemukan.";
                storyTextEl.classList.add('visible-text');
                return;
            }
            
            if (narrationAudioReady && narrationAudioEl.readyState >= HTMLMediaElement.HAVE_ENOUGH_DATA && narrationAudioEl.src === currentNarrationAudioSrc) {
                console.log(`'${activeSequenceName}': Narration audio already ready.`);
                startNarrationForActiveSequence();
            } else { 
                console.log(`'${activeSequenceName}': Narration audio needs to load or become ready.`);
                narrationAudioEl.addEventListener('canplaythrough', startNarrationForActiveSequence, { once: true });
                narrationAudioEl.addEventListener('error', handleNarrationLoadError, { once: true });
                if (narrationAudioEl.networkState === narrationAudioEl.NETWORK_EMPTY || 
                    narrationAudioEl.networkState === narrationAudioEl.NETWORK_NO_SOURCE ||
                    narrationAudioEl.src !== currentNarrationAudioSrc) { 
                    narrationAudioEl.load(); 
                } else if (narrationAudioEl.readyState < HTMLMediaElement.HAVE_ENOUGH_DATA){
                    console.log("Waiting for browser to load existing audio source.");
                }
            }
        }

        function handleNarrationTimeUpdate() {
            if (!narrationAudioEl || narrationAudioEl.paused || !activeSequenceName || !storySequences[activeSequenceName]?.[0]?.isNarration) {
                return;
            }

            const currentTime = narrationAudioEl.currentTime;
            const sequence = storySequences[activeSequenceName]; 
            if (!sequence) return;

            let activeSegmentFound = false;
            let newSegmentIndex = -1;

            for (let i = 0; i < sequence.length; i++) {
                const segment = sequence[i];
                if (currentTime >= segment.audioStart && currentTime < segment.audioEnd) {
                    newSegmentIndex = i;
                    activeSegmentFound = true;
                    break;
                }
            }

            if (activeSegmentFound) {
                if (currentNarrationSegmentIndex !== newSegmentIndex) {
                    const segmentToDisplay = sequence[newSegmentIndex];
                    if (storyTextEl.classList.contains('visible-text')) {
                        storyTextEl.classList.remove('visible-text');
                        setTimeout(() => { 
                            if (narrationAudioEl.paused || narrationAudioEl.currentTime < segmentToDisplay.audioStart || narrationAudioEl.currentTime >= segmentToDisplay.audioEnd) {
                                 if (storySequences[activeSequenceName]?.[0]?.isNarration && !narrationAudioEl.paused) {
                                     storyTextEl.innerHTML = ""; storyTextEl.classList.remove('visible-text'); currentNarrationSegmentIndex = -1;
                                }
                                return;
                            }
                            storyTextEl.innerHTML = segmentToDisplay.text;
                            storyTextEl.className = 'story-text'; 
                            if (segmentToDisplay.isDramatic) storyTextEl.classList.add(dramaticRevealClassName);
                            storyTextEl.classList.add('visible-text');
                        }, 200); 
                    } else {
                        storyTextEl.innerHTML = segmentToDisplay.text;
                        storyTextEl.className = 'story-text';
                        if (segmentToDisplay.isDramatic) storyTextEl.classList.add(dramaticRevealClassName);
                        storyTextEl.classList.add('visible-text');
                    }
                    currentNarrationSegmentIndex = newSegmentIndex;
                }
            } else { 
                if (storyTextEl.classList.contains('visible-text')) {
                    storyTextEl.classList.remove('visible-text');
                }
                currentNarrationSegmentIndex = -1; 
            }
        }

        function handleNarrationEnded() {
            if (!activeSequenceName || !storySequences[activeSequenceName]?.[0]?.isNarration) return;
            
            console.log(`Narration audio playback ended for '${activeSequenceName}'.`);
            const lastNarrationSegmentAction = storySequences[activeSequenceName][storySequences[activeSequenceName].length - 1]?.action;
            
            stopNarrationAndCleanup(true); // Preserve activeSequenceName for action execution

            if (lastNarrationSegmentAction) {
                executeStoryAction(lastNarrationSegmentAction);
            } else {
                storytellingOverlayEl.classList.remove('visible');
                if (mainContainerEl) mainContainerEl.classList.add('visible');
            }
            activeSequenceName = null; // Now reset activeSequenceName after action
        }
        
        function tryPlayMusic() { 
            if (!userInteractedForAudio) {
                 console.log("User interaction needed for background music.");
                return;
            }
            if (!musicStarted) {
                audio.volume = 0.6;
                audio.play().then(() => { musicStarted = true; console.log("Background music started."); })
                            .catch(e => console.error("Background music play failed:", e));
            } else if (audio.paused) {
                 audio.volume = 0.6;
                 audio.play().catch(e => console.error("Failed to resume background music:", e));
            }
        }

        function executeStoryAction(action) { 
            let hideOverlayAndShowCard = false;
            if (['showCountdownCard', 'showRevealButtonCard', 'showPostBirthdayCard', 'finalizeBirthdayMessages'].includes(action)) {
                hideOverlayAndShowCard = true;
            }

            if (action === 'showCountdownCard') { 
                if (mainTitleEl) mainTitleEl.innerHTML = "Hutan Menanti Saatnya"; 
                if (subtitleEl) subtitleEl.innerHTML = "Untuk Muhammad Rizal Setiawan, Penjaga Jiwa yang Bijaksana ✨"; 
                if (countdownEl) countdownEl.style.display = 'grid'; 
                if (revealBtn) revealBtn.style.display = 'none'; 
                if (birthdayContentEl) birthdayContentEl.style.display = 'none'; 
                if (cardEl) cardEl.classList.remove('content-revealed'); 
            }
            else if (action === 'showRevealButtonCard') { 
                if (mainTitleEl) mainTitleEl.innerHTML = "✨ GERBANG KEAJAIBAN SIAP DIBUKA ✨"; 
                if (subtitleEl) subtitleEl.innerHTML = "Rizal, hutan telah memanggilmu... Sentuh untuk menyingkap takdir."; 
                if (countdownEl) countdownEl.style.display = 'none'; 
                if (revealBtn) revealBtn.style.display = 'inline-block'; 
                if (birthdayContentEl) birthdayContentEl.style.display = 'none'; 
                if (cardEl) cardEl.classList.remove('content-revealed'); 

                if (userInteractedForAudio) {
                    if (currentCommandAudioPlayer && !currentCommandAudioPlayer.paused) {
                        currentCommandAudioPlayer.pause();
                        currentCommandAudioPlayer.currentTime = 0;
                    }
                    currentCommandAudioPlayer = new Audio(narrationAudioSrc_cardCommand);
                    currentCommandAudioPlayer.play().catch(e => console.error("Error playing card command audio:", e));
                } else {
                    playCommandAudioOnInteraction = true; 
                    console.warn("Card command audio playback deferred until user interaction.");
                }
            }
            else if (action === 'showPostBirthdayCard') { 
                if (mainTitleEl) mainTitleEl.innerHTML = "🌲 Jejak Hutan Menuju Tahun Depan 🌲"; 
                if (subtitleEl) subtitleEl.innerHTML = "Rizal, hutan menyimpan bisikan harapan untuk perayaan berikutnya..."; 
                if (birthdayContentEl) { 
                    birthdayContentEl.style.display = 'block'; 
                    birthdayContentEl.innerHTML = `<div class="birthday-message"><h2>🌟 Menantikan Musim Baru Bersamamu 🌟</h2><p>Saudaraku Rizal, seperti hutan yang bersemi kembali dengan harapan baru, kami menantikan perayaan kebijaksanaanmu di tahun depan. Semoga sisa waktu ini memberimu ketenangan dan inspirasi.</p></div><div class="birthday-message"><p>Biarlah akar-akar kebaikanmu semakin dalam, dan cabang-cabang prestasimu menjulang lebih tinggi. Hutan jiwa kami selalu merindukan kehadiranmu yang teduh.</p></div><div class="birthday-message"><p>💖 Dengan doa yang tak pernah gugur, kami menantimu di perayaan berikutnya. Semoga setiap hari adalah pertumbuhan menuju kesempurnaan. 💖</p></div>`; 
                    if (specialWishBtn) specialWishBtn.style.display = 'none'; 
                    if (specialWishContainer) specialWishContainer.style.display = 'none'; 
                } 
                if (countdownEl) countdownEl.style.display = 'none'; 
                if (revealBtn) revealBtn.style.display = 'none'; 
                if (cardEl) cardEl.classList.add('content-revealed'); 
            }
            else if (action === 'finalizeBirthdayMessages') {
                if (cardEl) cardEl.classList.add('content-revealed');
                if (mainTitleEl) { mainTitleEl.innerHTML = "🌿 KEBIJAKSANAAN HUTAN UNTUKMU 🌿"; }
                if (subtitleEl) { subtitleEl.innerHTML = "Rizal, Sebuah Pesan dari Alam Telah Tiba! 📜"; subtitleEl.style.animation = 'none'; subtitleEl.style.opacity = '0.93'; }
                if (birthdayContentEl) birthdayContentEl.style.display = 'block';
                if (specialWishBtn) specialWishBtn.style.display = 'inline-block';
                createLeafFallFull();
                tryPlayMusic();
            }

            if (hideOverlayAndShowCard) {
                storytellingOverlayEl.classList.remove('visible');
                if (mainContainerEl) {
                    mainContainerEl.style.opacity = '1'; 
                    mainContainerEl.classList.add('visible');
                }
            }
        }
        const fullSpecialWishContent = `<strong>Untuk Saudaraku Tercinta, Muhammad Rizal Setiawan, Sang Penjaga Jiwa yang Bijaksana,</strong><br><br>Di hari istimewa ini, dari rimbunnya hutan kasih sayang keluarga, kami merangkai doa tulus yang berakar kuat dan menjulang tinggi untukmu...<br><br><strong>🌳 Semoga Akarmu Semakin Kokoh Menancap di Bumi Kebenaran dan Kebijaksanaan:</strong><br>Rizal, kami berdoa semoga Allah SWT senantiasa menguatkan pijakanmu di atas landasan iman dan takwa. Laksana pohon kokoh yang akarnya menghujam dalam mencari sumber kehidupan, semoga engkau pun selalu menemukan kekuatan dalam ajaran-Nya, dan kebijaksanaan dalam setiap langkah yang kau tempuh.<br><br><strong>🍃 Semoga Ranting-ranting Kehidupanmu Dipenuhi Daun Kebaikan yang Rimbun:</strong><br>Kami berharap, setiap cabang usahamu menghasilkan buah-buah kebaikan yang manis. Semoga dedaunan prestasimu semakin rimbun, memberikan keteduhan bagi dirimu dan manfaat bagi sesama. Biarlah setiap hembusan angin membawa kabar baik tentang dirimu, dan setiap curah hujan menyuburkan amal-amalmu.<br><br><strong>☀️ Semoga Cahaya Ilahi Selalu Menerobos Kanopi Harapanmu:</strong><br>Walau terkadang perjalanan hidup terasa lebat dan gelap seperti hutan di malam hari, kami berdoa agar cahaya petunjuk dari Allah SWT selalu menemukan celah untuk menerangi jalanmu. Semoga hatimu tak pernah kehilangan harapan, dan jiwamu senantiasa menemukan ketenangan di bawah naungan kasih sayang-Nya.<br><br><strong>📜 Bisikan Doa dari Heningnya Hutan Keluarga:</strong><br><em>Ya Allah, Tuhan Yang Maha Pemelihara Alam Semesta,<br>Di hari kelahiran saudara kami, Muhammad Rizal Setiawan, kami memohon kehadirat-Mu:<br>Tumbuhkanlah dalam dirinya semangat yang tak pernah layu, hati yang senantiasa bersyukur laksana tanah yang subur, dan jiwa yang selalu dekat dengan-Mu seperti embun pagi yang menyucikan.<br>Jadikanlah ia pohon yang rindang, tempat berteduh bagi yang membutuhkan, dan penebar benih-benih kebaikan di mana pun ia berada.<br>Berkahilah usianya, lapangkanlah rezekinya, mudahkanlah segala urusannya, dan jadikanlah ia hamba-Mu yang shalih.<br>Ya Allah, dengarkanlah bisikan doa dari hutan hati kami ini. Aamiin ya Rabbal 'alamin.</em><br><br>Selamat bertambah usia, saudaraku! Teruslah tumbuh, menginspirasi, dan menjadi kebanggaan kami semua. 🌲✨💚<div class="from-siblings">- Dengan Cinta Sedalam Akar dan Setinggi Puncak Pohon, Semua Saudaramu -</div>`;
        
        function handleFirstInteraction() {
            if (!userInteractedForAudio) {
                userInteractedForAudio = true;
                console.log("First user interaction registered. Audio can now play.");
                if(startAdventureBtn) startAdventureBtn.style.display = 'none';

                audio.play().then(() => audio.pause()).catch(e => console.warn("Bg audio prime failed:", e));
                
                const sequenceNameToPrime = activeSequenceName; // Capture current active sequence

                if (narrationAudioEl) { 
                    let srcToPrime = null;
                    if (sequenceNameToPrime === 'beforeBirthday') srcToPrime = narrationAudioSrc_beforeBirthday;
                    else if (sequenceNameToPrime === 'onBirthdayProlog') srcToPrime = narrationAudioSrc_onBirthdayProlog;
                    else if (sequenceNameToPrime === 'afterThirtyDays') srcToPrime = narrationAudioSrc_afterThirtyDays;
                    
                    if (srcToPrime) {
                        if (narrationAudioEl.src !== srcToPrime) narrationAudioEl.src = srcToPrime;
                        narrationAudioEl.play().then(() => narrationAudioEl.pause()).catch(e => console.warn(`Narration prime for ${srcToPrime} failed:`, e));
                    }
                }

                if (playCommandAudioOnInteraction) {
                    if (currentCommandAudioPlayer && !currentCommandAudioPlayer.paused) { 
                        currentCommandAudioPlayer.pause();
                    }
                    currentCommandAudioPlayer = new Audio(narrationAudioSrc_cardCommand);
                    // Prime it
                    currentCommandAudioPlayer.play().then(()=> currentCommandAudioPlayer.pause()).catch(e => console.warn("Command audio prime failed:", e));
                    // Note: This command audio will be played *by* executeStoryAction if the conditions are met later
                    // playCommandAudioOnInteraction = false; // We don't reset this here yet, executeStoryAction handles it
                }

                // Now that interaction happened, try to play the initially intended sequence
                if (sequenceNameToPrime && storySequences[sequenceNameToPrime]?.[0]?.isNarration) {
                    console.log(`Attempting to start deferred '${sequenceNameToPrime}' narration after interaction.`);
                    playStorySequence(sequenceNameToPrime, true); // Pass true for isContinuation
                }
            }
        }

        if (startAdventureBtn) {
            startAdventureBtn.addEventListener('click', () => {
                handleFirstInteraction();
            });
        }


        if (revealBtn) { 
            revealBtn.addEventListener('click', () => {
                if (currentCommandAudioPlayer && !currentCommandAudioPlayer.paused) {
                    currentCommandAudioPlayer.pause();
                    currentCommandAudioPlayer.currentTime = 0; 
                    console.log("Card command audio stopped.");
                }
                playStorySequence('revealClickedStory');
            });
        }
        if (specialWishBtn) { 
            specialWishBtn.addEventListener('click', () => { if (specialWishContainer) { specialWishContainer.innerHTML = fullSpecialWishContent; specialWishContainer.style.display = 'block'; specialWishContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); } });
        }
        function updateCountdownDisplay(days, hours, minutes, seconds) { 
            if(document.getElementById('days')) document.getElementById('days').textContent = String(days).padStart(2, '0'); if(document.getElementById('hours')) document.getElementById('hours').textContent = String(hours).padStart(2, '0'); if(document.getElementById('minutes')) document.getElementById('minutes').textContent = String(minutes).padStart(2, '0'); if(document.getElementById('seconds')) document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        }

        function managePageContent() { 
            const now = Date.now();
            const targetBirthdayTime = birthdayDate;

            if (initialLoad) {
                if (mainContainerEl) mainContainerEl.classList.remove('visible');
                
                let sequenceToPlayOnLoad;
                if (now > targetBirthdayTime + thirtyDaysInMs) sequenceToPlayOnLoad = 'afterThirtyDays';
                else if (now >= targetBirthdayTime) sequenceToPlayOnLoad = 'onBirthdayProlog';
                else sequenceToPlayOnLoad = 'beforeBirthday';
                
                activeSequenceName = sequenceToPlayOnLoad; // Set activeSequenceName here
                playStorySequence(activeSequenceName); // This will show button if no interaction
                initialLoad = false;
            }

            // This interval mostly handles countdown and potentially showing reveal button
            // if the `onBirthdayProlog` sequence's action (`showRevealButtonCard`) hasn't run yet
            // due to narration still playing or other conditions.

            if (activeSequenceName === 'beforeBirthday' && now < targetBirthdayTime && countdownEl && countdownEl.style.display === 'grid') {
                const distance = targetBirthdayTime - now;
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                updateCountdownDisplay(days, hours, minutes, seconds);
            } 
            // The logic to show reveal button is now primarily handled by the 'action' in onBirthdayProlog
            // This interval part is more of a fallback or for cases where the countdown just ended.
            else if (now >= targetBirthdayTime && 
                     activeSequenceName === 'onBirthdayProlog' && // Ensure we are in the correct context
                     !cardEl.classList.contains('content-revealed') && 
                     revealBtn && revealBtn.style.display === 'none') { 

                const isNarrationStoryActive = storytellingOverlayEl.classList.contains('visible') && 
                                             narrationAudioEl && !narrationAudioEl.paused;
                const isStartButtonVisible = startAdventureBtn && startAdventureBtn.style.display !== 'none';

                if (!isNarrationStoryActive && !isStartButtonVisible) { 
                    // If narration for onBirthdayProlog has finished (or failed)
                    // and start button is not visible (meaning interaction happened or wasn't needed)
                    // then it's safe to try showing the reveal button if its action hasn't run.
                    // The action in onBirthdayProlog itself should handle this, but this is a safeguard.
                    // executeStoryAction('showRevealButtonCard'); // This might be redundant if action in sequence handles it.
                                                              // Let's rely on the sequence action for now.
                }
            }
        }
        const countdownInterval = setInterval(managePageContent, 1000);
        managePageContent();

        function createStaticFirefliesFull() { if (!firefliesContainer) return; firefliesContainer.innerHTML = ''; for (let i = 0; i < numFireflies; i++) { const firefly = document.createElement('div'); firefly.className = 'firefly'; firefly.style.left = Math.random() * 100 + 'vw'; firefly.style.top = Math.random() * 100 + 'vh'; firefly.style.animationDelay = Math.random() * 11 + 's'; firefly.style.animationDuration = (Math.random() * 6 + 5) + 's'; firefly.style.setProperty('--firefly-drift-x', (Math.random() - 0.5) * 100 + 'px'); firefly.style.setProperty('--firefly-drift-y', (Math.random() - 0.5) * 100 + 'px'); firefly.style.setProperty('--firefly-opacity', (Math.random() * 0.45 + 0.45).toFixed(2)); let size; const sizeRoll = Math.random(); if (sizeRoll < 0.30) { size = Math.random() * 0.8 + 1.0; } else if (sizeRoll < 0.60) { size = Math.random() * 1.0 + 1.8; } else if (sizeRoll < 0.85) { size = Math.random() * 1.2 + 2.8; } else if (sizeRoll < 0.95) { size = Math.random() * 1.0 + 4.0; } else { size = Math.random() * 1.0 + 5.0; } firefly.style.setProperty('--firefly-size', size.toFixed(1) + 'px'); firefly.style.setProperty('--firefly-scale-start', (Math.random() * 0.25 + 0.35).toFixed(2)); firefly.style.setProperty('--firefly-scale-mid', (Math.random() * 0.35 + 0.85).toFixed(2)); firefly.style.setProperty('--firefly-scale-end', (Math.random() * 0.25 + 0.35).toFixed(2)); firefliesContainer.appendChild(firefly); } }
        function createForestSparklesFull() { 
            if (!forestSparklesContainer) return; 
            forestSparklesContainer.innerHTML = ''; 
            for (let i = 0; i < numForestSparkles; i++) { 
                const sparkle = document.createElement('div'); 
                sparkle.className = 'forest-sparkle'; 
                sparkle.style.left = Math.random() * 100 + 'vw'; 
                sparkle.style.animationDelay = Math.random() * 8.5 + 's'; 
                sparkle.style.setProperty('--sparkle-drift-x', (Math.random() - 0.5) * 120 + 'px'); 
                forestSparklesContainer.appendChild(sparkle); 
            } 
        }
        function createLeafFallFull() { if (!leafFallContainer) return; leafFallContainer.innerHTML = ''; leafFallContainer.style.display = 'block'; const leafColors = ['%232E8B57', '%23556B2F', '%238FBC8F', '%23DAA520', '%23B8860B', '%23CD853F', '%23A0522D', '%238B4513', '%2366CDAA', '%233CB371']; const leafCount = window.innerWidth < 768 ? 45 : 75; for (let i = 0; i < leafCount; i++) { const leaf = document.createElement('div'); leaf.className = 'leaf'; const randomColor = leafColors[Math.floor(Math.random() * leafColors.length)]; const svgPaths = [ 'M50,0 C25,20 15,65 50,100 C85,65 75,20 50,0 Z', 'M50,0 C20,25 10,70 50,100 C90,70 80,25 50,0 Z', 'M50,0 C30,15 25,60 50,100 C75,60 70,15 50,0 Z', 'M50,0 Q20,30 50,100 Q80,30 50,0 Z' ]; const svgPath = svgPaths[Math.floor(Math.random() * svgPaths.length)]; leaf.style.backgroundImage = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="${svgPath}" fill="${randomColor}" transform="rotate(${Math.random()*360} 50 50)"/></svg>')`; leaf.style.left = Math.random() * 100 + 'vw'; leaf.style.animationDelay = Math.random() * 9 + 's'; leaf.style.animationDuration = (Math.random() * 7 + 9) + 's'; leaf.style.setProperty('--leaf-drift-x-mid', (Math.random() - 0.5) * 140 + 'px'); leaf.style.setProperty('--leaf-drift-x-end', (Math.random() - 0.5) * 240 + 'px'); leafFallContainer.appendChild(leaf); } }

        createStaticFirefliesFull();
        createForestSparklesFull();
    </script>
</body>
</html>
